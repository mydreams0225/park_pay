$(function(){$(".loadingbox").hide();$("#pay").attr({disabled:"disabled"});var n=$.getUrlParam("shopId"),t=$.getUrlParam("openId"),r=$.getUrlParam("channelId"),i="输入车牌查询停车费",u=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼]{1}$/,f=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼]{1}[A-Z]{1}[A-Z0-9]{5}$/,e=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼]{1}[A-Z]{1}[A-Z0-9]{5}[A-Z0-9学港澳]{1}$/;document.getElementById("platenum").innerHTML=i;document.body.addEventListener("touchmove",function(n){n.preventDefault()},!1);$.StringIsNullOrUndefined(t)||$.StringIsNullOrUndefined(n)||searchCarInfo("",t,n);$(".shuru").click(function(n){var r=document.getElementById("platenum"),t=r.innerHTML;(t===""||t===null||t===i)&&(showProvinceKB(),n.stopPropagation(),r.innerHTML="")});$("#form_edit .num").click(function(){var t=document.getElementById("platenum"),n=t.innerHTML;n===i&&(n="");n=n+this.innerHTML;$.CheckPlateNumRule(n)&&(t.innerHTML=n);u.test(n)&&hideProvinceKB()});$("#remove").click(function(n){var t=document.getElementById("platenum"),i=t.innerHTML;t.innerHTML=i.substring(0,i.length-1);(t.innerHTML===""||t.innerHTML===null)&&(showProvinceKB(),n.stopPropagation())});$("#search").click(function(){var t=$("#platenum").text();if($.StringIsNullOrUndefined(t)){iosOverlay({text:"请录入车牌号",duration:2e3,icon:"../../Content/image/cross.png"});return}if(!f.test(t)&&!e.test(t)){iosOverlay({text:"车牌号有误",duration:2e3,icon:"../../Content/image/cross.png"});return}searchCarInfo(t,"",n)});$("#pay").click(function(){$("#pay").attr({disabled:"disabled"});var i=$("#platenum").html();$.ajax({type:"POST",url:"/api/INativePay/js_pay",data:JSON.stringify({shopId:n,total:$("#sp_total").html(),real:$("#sp_real").html(),plateNum:plateNumHandler(i,t),cardNo:t,inTime:$("#inp_inTime").val(),outTime:$("#inp_outTime").val(),parkTime:$("#inp_parkTime").val(),channelId:r}),contentType:"application/json",dataType:"json",async:!0,success:function(n){if($.StringIsNullOrUndefined(n)){alert("数据加载失败，请重新扫码支付");return}if(n.errcode===0){var t=eval("("+n.data+")"),i=eval("("+n.attach+")");callpay(t,i)}else alert(n.errmsg)},error:function(n){var t=n}})})});var hideProvinceKB=function(){$(".layer-province").animate({bottom:"-200px"},200)},showProvinceKB=function(){$(".layer-province").animate({bottom:0},200)},plateNumHandler=function(n,t){return $.StringIsNullOrUndefined(t)?n:""},searchCarInfo=function(n,t,i){$(".loadingbox").show();n=plateNumHandler(n,t);$.ajax({type:"POST",url:"../../api/IPark/findParkInfo",data:JSON.stringify({plateNum:n,cardNo:t,shopId:i}),contentType:"application/json",success:function(n){if($(".loadingbox").hide(),$("#pay").removeAttr("disabled"),$.StringIsNullOrUndefined(n))console.warn("FindParkInfo api return data is null");else if(n.errcode===0){$("#sp_time").html(n.data.parkTime);$("#sp_total").html(n.data.chargeMoney);$("#sp_discount").html(n.data.discount);$("#sp_real").html(n.data.money);$("#inp_inTime").val(n.data.inTime);$("#inp_outTime").val(n.data.outTime);$("#inp_parkTime").val(n.data.parkTime);var i=!0;$.StringIsNullOrUndefined(t)||(i=!1);$("#paylayer").reveal($(this).data(),i);$(".reveal-modal-bg").append("<div class='close'><\/div>")}else n.errcode===3102?iosOverlay({text:"无需支付",duration:2e3,icon:"../../Content/image/check.png"}):iosOverlay({text:"没有找到车辆信息",duration:2e3,icon:"../../Content/image/cross.png"})},error:function(n){$(".loadingbox").hide();console.error(n)}})};